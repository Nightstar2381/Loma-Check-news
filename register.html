<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</title>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f4f4f4; }
        .container { margin-top: 50px; }
        input {
            padding: 10px;
            margin: 10px;
            width: 300px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            padding: 10px 20px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover { background: #b71c1c; }
    </style>
</head>
<body>
    <div class="container">
        <h2>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
        <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
        <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" autocomplete="new-password">
        <button id="registerBtn">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        <p>‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? <a href="login.html">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a></p>
    </div>

    <script>
        // ‚úÖ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® Supabase ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        const supabaseUrl = "https://zfdecmvrvmdvwksvivwd.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmZGVjbXZydm1kdndrc3ZpdndkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE3MjAwMDQsImV4cCI6MjA1NzI5NjAwNH0.bDzI0gWKFF_lQRbjL5WOYIG0h1fFBQF8MxMPXWH_rEg";

        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        console.log("‚úÖ Supabase Client Initialized:", supabase);

        document.addEventListener("DOMContentLoaded", async function() {
            document.getElementById("registerBtn").addEventListener("click", async function () {
                const email = document.getElementById("email").value.trim();
                const password = document.getElementById("password").value.trim();

                if (!email || !password) {
                    alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");
                    return;
                }

                try {
                    console.log("üìå Checking if email already exists:", email);

                    let { data: existingUser, error: checkError } = await supabase
                        .from("users")
                        .select("email")
                        .eq("email", email)
                        .single();

                    if (existingUser) {
                        alert("‚ùå ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏•‡∏≠‡∏∑‡πà‡∏ô");
                        return;
                    }

                    console.log("üìå Registering email:", email, "password:", password);

                    const { data, error } = await supabase.auth.signUp({ email, password });

                    if (error) {
                        console.error("‚ùå SignUp Error:", error.message);
                        alert("‚ùå ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + error.message);
                        return;
                    }

                    console.log("‚úÖ SignUp Success:", data);

                    const { error: userError } = await supabase
                        .from("users")
                        .insert([{ email, role: "user" }]);

                    if (userError) throw userError;

                    alert("‚úÖ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢");
                    window.location.href = "login.html";
                } catch (error) {
                    console.error("‚ùå ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", error.message);
                    alert("‚ùå ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + error.message);
                }
            });
        });
    </script>
</body>
</html>
