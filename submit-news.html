<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake News Checker - ‡∏™‡πà‡∏á‡∏Ç‡πà‡∏≤‡∏ß</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- ‚úÖ ‡πÇ‡∏´‡∏•‡∏î Supabase SDK ‚úÖ -->
    <script src="https://unpkg.com/@supabase/supabase-js"></script>

    <style>
        body { background-color: #f4f4f4; color: #333; font-family: 'Arial', sans-serif; padding-top: 50px; }
        .card { background-color: #ffffff; border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); }
        .card-header { background-color: #b71c1c; color: white; text-align: center; font-size: 1.5rem; font-weight: bold; }
        .container { max-width: 600px; }
        .btn-primary { background-color: #b71c1c; border: none; }
        .btn-primary:hover { background-color: #9a1a17; }
    </style>
</head>
<body>

    <div class="container d-flex justify-content-center align-items-center" style="height: 100vh;">
        <div class="card" style="width: 100%; max-width: 500px;">
            <div class="card-header">
                <h4>‡∏™‡πà‡∏á‡∏Ç‡πà‡∏≤‡∏ß‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</h4>
            </div>
            <div class="card-body">
                <form id="submitNewsForm">
                    <div class="mb-3">
                        <label for="title" class="form-label">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß</label>
                        <input type="text" class="form-control" id="title" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πà‡∏≤‡∏ß</label>
                        <textarea class="form-control" id="description" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πà‡∏≤‡∏ß" rows="4" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="image" class="form-label">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏Ç‡πà‡∏≤‡∏ß</label>
                        <input type="file" class="form-control" id="image" required>
                    </div>
                    <div class="mb-3">
                        <label for="url" class="form-label">‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πà‡∏≤‡∏ß</label>
                        <input type="url" class="form-control" id="url" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πà‡∏≤‡∏ß" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">‡∏™‡πà‡∏á‡∏Ç‡πà‡∏≤‡∏ß</button>
                </form>
                <button onclick="window.location.href='index.html'" class="btn btn-secondary w-100 mt-3">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function() {
            console.log("üìå ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î Supabase...");

            // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Supabase SDK ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (typeof window.supabase === "undefined") {
                console.error("‚ùå Supabase ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î! ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏•‡∏¥‡∏á‡∏Å‡πå <script>");
                alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î Supabase ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö!");
                return;
            }

            // ‚úÖ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase Client ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            const supabaseUrl = "https://zfdecmvrvmdvwksvivwd.supabase.co";
            const supabaseKey = "YOUR_SUPABASE_ANON_KEY";  // üî• ‡πÉ‡∏™‡πà API Key ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            window.supabase = supabase.createClient(supabaseUrl, supabaseKey);

            console.log("‚úÖ Supabase Client Initialized:", supabase);

            document.getElementById("submitNewsForm").addEventListener("submit", async function(event) {
                event.preventDefault();

                const title = document.getElementById("title").value;
                const description = document.getElementById("description").value;
                const url = document.getElementById("url").value;
                const file = document.getElementById("image").files[0];

                if (!file) {
                    alert("‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πà‡∏≤‡∏ß!");
                    return;
                }

                try {
                    console.log("üìå ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÑ‡∏õ‡∏¢‡∏±‡∏á Cloudinary...");

                    // ‚úÖ ‡πÉ‡∏™‡πà‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å Cloudinary ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                    const cloudinaryName = "dxrqema2e";  // üî• Cloud Name ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
                    const uploadPreset = "news_upload"; // üî• Upload Preset ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ

                    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏õ‡∏ó‡∏µ‡πà Cloudinary
                    const formData = new FormData();
                    formData.append("file", file);
                    formData.append("upload_preset", uploadPreset);

                    const cloudinaryResponse = await fetch(`https://api.cloudinary.com/v1_1/${cloudinaryName}/image/upload`, {
                        method: "POST",
                        body: formData
                    });

                    if (!cloudinaryResponse.ok) throw new Error("‚ùå ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Cloudinary API Key");

                    const cloudinaryData = await cloudinaryResponse.json();
                    const imageUrl = cloudinaryData.secure_url;
                    console.log("‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", imageUrl);

                    console.log("üìå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡∏á Supabase...");

                    // ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πà‡∏≤‡∏ß‡∏•‡∏á Supabase
                    const { data, error } = await supabase.from("pending_news").insert([
                        {
                            title: title,
                            description: description,
                            imageUrl: imageUrl,
                            url: url,
                            approved: false,
                            created_at: new Date().toISOString()
                        }
                    ]);

                    if (error) throw error;

                    alert("‚úÖ ‡∏Ç‡πà‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß!");
                    window.location.href = "index.html";
                } catch (error) {
                    console.error("‚ùå Error:", error);
                    alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
                }
            });
        });
    </script>

</body>
</html>
